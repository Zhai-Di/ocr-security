# README
This directory contains the artifact for the paper _Validity Is Not Enough: Uncovering the Security Pitfall in Chainlink's Off-Chain Reporting Protocol_. Specifically, this artifact includes the datasets we used and our experiments. The requirements for running our experiments are listed in [requirements.txt](https://github.com/Zhai-Di/ocr-security/blob/main/requirements.txt). 
- [./data/](https://github.com/Zhai-Di/ocr-security/tree/main/data). This directory contains datasets used in our experiments. The file ens_case_data.7z.001 is a compressed dataset and can be extracted using 7-Zip.
- [./analysis_scripts/](https://github.com/Zhai-Di/ocr-security/tree/main/analysis_scripts). This directory contains the main analysis scripts used in Section IV. Further details are described below.
  - [sec4_filter_eth_usd_full_lists.py](https://github.com/Zhai-Di/ocr-security/blob/main/analysis_scripts/sec4_filter_eth_usd_full_lists.py) is used to confirm that [eth_usd_full_lists.csv](https://github.com/Zhai-Di/ocr-security/blob/main/data/eth_usd_full_lists.csv) correctly filters historical ETH/USD price feed instances with complete observations lists.
  - [sec4_measure_eth_usd_honest_range.py](https://github.com/Zhai-Di/ocr-security/blob/main/analysis_scripts/sec4_measure_eth_usd_honest_range.py) is used to measure the honest range of historical ETH/USD price feed instances and can be run to reproduce Figure 4.
  - [sec4_dex_prices_event.py](https://github.com/Zhai-Di/ocr-security/blob/main/analysis_scripts/sec4_dex_prices_event.py) fetches ETH/USD price data from Uniswap and Sushiswap.
  - [sec4_dex_window_prices.py](https://github.com/Zhai-Di/ocr-security/blob/main/analysis_scripts/sec4_dex_window_prices.py) calculates statistics over Uniswap or Sushiswap price data for each 13-block window.
  - [sec4_uni_sushi_window.py](https://github.com/Zhai-Di/ocr-security/blob/main/analysis_scripts/sec4_uni_sushi_window.py) merges the price statistics from Uniswap and Sushiswap within each 13-block window.
  - [sec4_fig3.py](https://github.com/Zhai-Di/ocr-security/blob/main/analysis_scripts/sec4_fig3.py) can be run to reproduce Figure 3.
- [./sec6_a/](https://github.com/Zhai-Di/ocr-security/tree/main/sec6_a) and [./sec6_b/](https://github.com/Zhai-Di/ocr-security/tree/main/sec6_b). Running the code in these two directories reproduces the experimental results in Section VI-A and Section VI-B of the paper, respectively.
- [./sec6_c/](https://github.com/Zhai-Di/ocr-security/tree/main/sec6_c). This directory is used to reproduce the experiments presented in Section VI-C of the paper.
  - [fetch_liqs.py](https://github.com/Zhai-Di/ocr-security/blob/main/sec6_c/fetch_liqs.py) fetches the liquidation data used for our case study in Section VI-C.
  - [liq_case_study_tbl10.py](https://github.com/Zhai-Di/ocr-security/blob/main/sec6_c/liq_case_study_tbl10.py), [ens_revenue_inflation.py](https://github.com/Zhai-Di/ocr-security/blob/main/sec6_c/ens_revenue_inflation.py), and [ens_revenue_deflation.py](https://github.com/Zhai-Di/ocr-security/blob/main/sec6_c/ens_revenue_deflation.py) can be executed to reproduce the experimental results in Section VI-C.
- [./sec7/](https://github.com/Zhai-Di/ocr-security/tree/main/sec7). Running the code in this directory reproduces the experimental results in Section VII of the paper.
- [./appx_b/](https://github.com/Zhai-Di/ocr-security/tree/main/appx_b). This directory reproduces the experiments in Appendix B. Further details are given below.
  - [eth_usd_sensitivity_honest_range.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_b/eth_usd_sensitivity_honest_range.py) is used to measure the extent to which the honest range of the ETH/USD price feeds can reach under different parameter settings.
  - [eth_usd_sensitivity_metric_1.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_b/eth_usd_sensitivity_metric_1.py) is used to evaluate the extent to which the metric _Byzantine-induced price deviation_ can reach for the ETH/USD price feeds under different parameter settings.
  - [eth_usd_sensitivity_metric_1.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_b/eth_usd_sensitivity_metric_2.py) is used to evaluate the extent to which the metric _maximum uncertain price deviation_ can reach for the ETH/USD price feeds under different parameter settings.
- [./appx_d/](https://github.com/Zhai-Di/ocr-security/tree/main/appx_d). This directory reproduces the experiments in Appendix D. Further details are given below.
  - [bnb_usd_sensitivity_honest_range.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_d/bnb_usd_sensitivity_honest_range.py) is used to measure the extent to which the honest range of the BNB/USD price feeds can reach under different parameter settings.
  - [bnb_usd_honest_range_fig.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_d/bnb_usd_honest_range_fig.py) reproduces the experimental results shown in Figure 9.
  - [bnb_price_deviation.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_d/bnb_price_deviation.py) and [bnb_price_uncertainty.py](https://github.com/Zhai-Di/ocr-security/blob/main/appx_d/bnb_price_uncertainty.py) are used to evaluate the metrics _Byzantine-induced price deviation_ and _maximum uncertain price deviation_ of the BNB/USD price feeds, respectively, under a maximum acceptable natural variation ratio of 0.06.
