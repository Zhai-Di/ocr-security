# Artifact
This repository contains the artifact for the paper _Validity Is Not Enough: Uncovering the Security Pitfall in Chainlink's Off-Chain Reporting Protocol_. Specifically, this artifact includes the code for data collection, analyses, and experiments, as well as the datasets we used. The requirements for running our experiments are listed in [requirements.txt](https://github.com/SecurityDON/Artifact/blob/main/requirements.txt).
- [./data/](https://github.com/SecurityDON/Artifact/tree/main/data). This directory contains the data we collected. Among them, our experiments primarily use [all_observations.csv](https://github.com/SecurityDON/Artifact/blob/main/data/all_observations.csv), [observations_31_exp.csv](https://github.com/SecurityDON/Artifact/blob/main/data/observations_31_exp.csv), [honest_observations.csv](https://github.com/SecurityDON/Artifact/blob/main/data/honest_observations.csv), and [ens_case_data.7z.001](https://github.com/SecurityDON/Artifact/blob/main/data/ens_case_data.7z.001).
  - [all_observations.csv](https://github.com/SecurityDON/Artifact/blob/main/data/all_observations.csv). Observation values from historical instances of Chainlink's ETH/USD price feed, covering the block range from 12,016,450 to 22,648,562.
  - [observations_31_exp.csv](https://github.com/SecurityDON/Artifact/blob/main/data/observations_31_exp.csv). Chainlink's historical ETH/USD price feed instances containing 31 observation values.
  - [honest_observations.csv](https://github.com/SecurityDON/Artifact/blob/main/data/honest_observations.csv). The dataset resulting from the filtering described in Section IV-B2. Every observation value in this dataset can be regarded as honest.
  - [ens_case_data.7z.001](https://github.com/SecurityDON/Artifact/blob/main/data/ens_case_data.7z.001). The compressed dataset used for the experiment of ENS case study in Section VI-RQ3. To reconstruct the original dataset, download and extract it using 7-Zip.
  - [./AllPairsEvents/](https://github.com/SecurityDON/Artifact/tree/main/data/AllPairsEvents). Price observation values for all other pairs on the Ethereum mainnet that we collected, excluding the ETH/USD pair.
  - [AggStartBlock.csv](https://github.com/SecurityDON/Artifact/blob/main/data/AggStartBlock.csv). Our manually collected information on Chainlink's proxy contracts and associated aggregator contracts used for providing price feeds on the Ethereum mainnet.
- [./data_collection/](https://github.com/SecurityDON/Artifact/tree/main/data_collection). This directory is used to collect price observation values from Chainlink's decentralized oracle networks for price feeds. [fetch_all_pairs_price_observations.py](https://github.com/SecurityDON/Artifact/blob/main/data_collection/fetch_all_pairs_price_observations.py) provides a general framework for collecting price observation values for all pairs, while [fetch_eth_usd_price_observations.py](https://github.com/SecurityDON/Artifact/blob/main/data_collection/fetch_eth_usd_price_observations.py) is specifically designed for collecting ETH/USD price observation values.
- [./analyses/](https://github.com/SecurityDON/Artifact/tree/main/analyses). This directory contains the code corresponding to the analyses described in Section IV. Specifically, their functions are as follows.
  - [select_31_observations.py](https://github.com/SecurityDON/Artifact/blob/main/analyses/select_31_observations.py) selects instances containing 31 observation values from Chainlink's historical price feed instances.
  - [historical_max_nv.py](https://github.com/SecurityDON/Artifact/blob/main/analyses/historical_max_nv.py) is used to analyze the historical maximum natural variation.
  - [filter_honest_observations.py](https://github.com/SecurityDON/Artifact/blob/main/analyses/filter_honest_observations.py) is used to filter observation values that can be regarded as honest.
- [./experiments/](https://github.com/SecurityDON/Artifact/tree/main/experiments). This directory contains the code used in our experiments.
  - [sec4_width_of_honest_range.py](https://github.com/SecurityDON/Artifact/blob/main/experiments/sec4_width_of_honest_range.py) can be used to reproduce the experimental results shown in Figure 2 of Section IV.
  - [sec6_RQ1.py](https://github.com/SecurityDON/Artifact/blob/main/experiments/sec6_RQ1.py) corresponds to the experimental code for RQ1 presented in Section VI.
  - [sec6_RQ2.py](https://github.com/SecurityDON/Artifact/blob/main/experiments/sec6_RQ2.py) corresponds to the experimental code for RQ2 presented in Section VI.
  - [sec6_RQ3_ens_case.py](https://github.com/SecurityDON/Artifact/blob/main/experiments/sec6_RQ3_ens_case.py) implements the ENS case study experiment in Section VI-RQ3. To reproduce the experimental results, the dataset in [ens_case_data.7z.001](https://github.com/SecurityDON/Artifact/blob/main/data/ens_case_data.7z.001) needs to be extracted.
  - [sec7_mitigation.py](https://github.com/SecurityDON/Artifact/blob/main/experiments/sec7_mitigation.py) implements the mitigation approach proposed in Section VII, which is based on the application of Dolev's approximation function, and compares this approach with the method used in the current OCR protocol.
